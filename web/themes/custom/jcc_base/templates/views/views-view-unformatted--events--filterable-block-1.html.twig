{#
/**
 * @file
 * Default theme implementation to display a view of unformatted rows.
 *
 * Available variables:
 * - title: The title of this group of rows. May be empty.
 * - rows: A list of the view's row items.
 *   - attributes: The row's HTML attributes.
 *   - content: The row's content.
 * - view: The view object.
 * - default_row_class: A flag indicating whether default classes should be
 *   used on rows.
 *
 * @see template_preprocess_views_view_unformatted()
 *
 * @ingroup themeable
 */
#}

{% if view.title %}
  {% set header_title = view.title|t %}
{% endif %}

{% set tiles = [] %}
{% for row in rows %}
  {% set title = row.content['#row']._entity.title.value %}
  {% set excerpt = row.content['#row']._entity.body.value|striptags %}
  {% set url = path('entity.node.canonical', {'node': row.content['#row']._entity.nid[0].value}) %}
  {% set start_date = row.content['#row']._entity.field_date_range[0].start_date %}
  {% set img_src = file_url(row.content['#row']._entity.field_images.entity.field_media_image.entity.uri.value) %}
  {% set img_alt = row.content['#row']._entity.field_images.entity.field_media_image.alt %}

  {% set recent_event_card = {
    card: {
      title: title,
      excerpt: excerpt|length > 600 ? excerpt|slice(0, 600) ~ 'â€¦' : excerpt,
      url: url
    },
    date: start_date,
    img: {
      src: img_src,
      alt: img_alt,
      renderer: 'patternlab',
    }
  } %}

  {% set tiles = tiles|merge([recent_event_card]) %}
{% endfor %}

{% if view.pager.displayHandler.display.display_options.use_more == true %}
  {% set button_text = view.pager.displayHandler.display.display_options.use_more_text %}
  {% set button_url = "/event" %}

  {% set button = {
    "text": button_text,
    "url": button_url,
    "style": 'primary'
  } %}
{% else %}
  {% set button = {} %}
{% endif %}

{% include "@organisms/sections/tiles-list/tiles-list.twig" with {
  tiles_list: {
    headergroup: {
      title: header_title,
    },
    tiles: tiles,
    button: button
  }
} only %}
